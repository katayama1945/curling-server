<html>
<head>
  <meta charset="utf-8">
  <title>ã‚«ãƒ¼ãƒªãƒ³ã‚°å¯¾æˆ¦</title>
</head>
<body>
  <h1>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚«ãƒ¼ãƒªãƒ³ã‚°</h1>
  <div id="statusDiv">çŠ¶æ…‹ã‚’å–å¾—ä¸­...</div>
  <input id="nameInput" placeholder="åå‰ã‚’å…¥åŠ›">
  <button id="joinBtn" style="display:inline;">ğŸ® å‚åŠ ã™ã‚‹</button>

  <script>
 window.onload = function () {

const statusDiv = document.getElementById("statusDiv");
const joinBtn = document.getElementById("joinBtn");
const nameInput = document.getElementById("nameInput");

let ws;

function connectWebSocket() {
  ws = new WebSocket("wss://curling-server.onrender.com");

  ws.onopen = () => {
    console.log("ğŸ”Œ WebSocketæ¥ç¶š");
  };

  ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    console.log("å—ä¿¡:", data);

    if (data.type === "status") {
      const msg = {
        "idle": "ğŸŸ¢ å‚åŠ è€…å—ä»˜ä¸­",
        "waiting": `ğŸŸ¡ ${data.player1 ?? "èª°ã‹"} ãŒå¯¾æˆ¦è€…å—ä»˜ä¸­...`,
        "playing": `ğŸ”´ å¯¾æˆ¦ä¸­ï¼š${data.player1 ?? "A"} vs ${data.player2 ?? "B"}`
      };
      statusDiv.textContent = msg[data.status];

      if (data.status === "idle" || data.status === "waiting") {
        joinBtn.style.display = "inline";
      } else {
        joinBtn.style.display = "none";
      }
    }
  };

  ws.onerror = (e) => {
    console.error("âŒ WebSocketã‚¨ãƒ©ãƒ¼:", e);
  };

  ws.onclose = () => {
    console.warn("ğŸ”Œ WebSocketåˆ‡æ–­ã€‚å†æ¥ç¶šã—ã¾ã™...");
    setTimeout(connectWebSocket, 2000); // 2ç§’å¾Œã«å†æ¥ç¶š
  };
}

joinBtn.addEventListener("click", () => {
  const name = nameInput.value.trim();
  if (!name) {
    alert("åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  if (ws && ws.readyState === WebSocket.OPEN) {
    ws.send(JSON.stringify({ type: "join", name }));
    console.log("ğŸ“¤ å‚åŠ ãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡");
    joinBtn.style.display = "none";
  } else {
    alert("WebSocketãŒæ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚");
  }
});

// â— ã“ã“ã§ WebSocket ã‚’æ¥ç¶šã™ã‚‹
connectWebSocket();
};
</script>
</body>
</html>
